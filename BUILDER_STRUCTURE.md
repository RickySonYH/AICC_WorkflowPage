# 🏗️ 빌더 구조 정리

## 개념 계층 구조

```
시나리오 (Scenario)
  ├─ 워크플로우 1 (Workflow)
  │   ├─ START 노드
  │   ├─ AI 답변 노드
  │   ├─ 상태 변경 노드
  │   └─ END 노드
  ├─ 워크플로우 2
  └─ 워크플로우 3
```

## 1️⃣ 워크플로우 빌더 (Workflow Builder)

### 목적
**개별 워크플로우 내부의 노드를 설계합니다.**

### 진입 방법
1. **워크플로우 라이브러리** 탭 → 워크플로우 카드 클릭
2. 워크플로우 상세 모달 → **[편집]** 버튼

### 화면 구성
```
┌────────────────────────────────────────────────────────┐
│ ECS이커머스 반품 안내 상담사          [+노드추가] [저장]│
├────────────────────────────────────────────────────────┤
│                                                         │
│   [START]         [AI답변]        [상태변경]   [END]   │
│   초기상담사 ──→  반품상담사 ─┬─→  반품엔드 ──→ 종료   │
│                              │                         │
│                              └─→  메인엔드            │
│                                 loop      main         │
│                                                         │
└────────────────────────────────────────────────────────┘
```

### 노드 유형

#### 🟢 START 노드
- 워크플로우의 시작점
- 1개만 존재
- 삭제 불가

#### 🔵 AI 답변 노드
- 프롬프트 기반 AI 응답
- **Attribute 설정**:
  - 프롬프트: `ECS이커머스_반품_상담사_v1.0`
  - 모델 선택
  - Temperature 등 파라미터

#### 🟢 상태 변경 노드
- 다른 워크플로우로 전환
- 조건부 분기 가능
- 연결선에 라벨 지정 (예: "전환(loop)", "메인(main)")

#### 🔴 END 노드
- 워크플로우 종료점
- 워크플로우 전환 설정
- 1개만 존재
- 삭제 불가

### 연결선
- **실선**: 기본 흐름
- **점선**: 조건부 분기 (loop, main 등)
- 라벨로 분기 조건 표시

### 주요 기능
- **노드 추가**: 오른쪽 사이드바에서 선택
- **노드 이동**: 드래그앤드롭
- **노드 삭제**: 노드 우측 상단 ✕
- **노드 설정**: 노드 우측 상단 ⚙
- **연결선 그리기**: 연결점 클릭 → 드래그

---

## 2️⃣ 시나리오 플로우 에디터 (Scenario Flow Editor)

### 목적
**여러 워크플로우를 조합하여 시나리오를 구성합니다.**

### 진입 방법
1. **시나리오 구성** 탭 → **[🎯 새 시나리오]** 버튼
2. 모드 선택 → **플로우 에디터 모드** 선택

### 화면 구성
```
┌────────────────────────────────────────────────────────┐
│ 기본 고객센터 응대 시나리오       [+워크플로우추가] [저장]│
├────────────────────────────────────────────────────────┤
│                                                         │
│   [워크플로우1]    [워크플로우2]    [워크플로우3]       │
│   초기 인사   ──→  고객정보확인 ──→  용건 파악         │
│                                                         │
└────────────────────────────────────────────────────────┘
```

### 노드 유형
- **워크플로우 노드**: 라이브러리의 완성된 워크플로우
- 각 워크플로우는 내부에 여러 노드를 가짐
- 워크플로우 간 연결로 시나리오 흐름 정의

### 주요 기능
- **워크플로우 추가**: 라이브러리에서 선택
- **워크플로우 배치**: 드래그앤드롭
- **워크플로우 연결**: 연결선 그리기
- **워크플로우 삭제**: 노드 우측 상단 ✕

---

## 비교표

| 항목 | 워크플로우 빌더 | 시나리오 플로우 에디터 |
|------|----------------|---------------------|
| **대상** | 워크플로우 내부 | 워크플로우 조합 |
| **노드** | START, AI답변, 상태변경, END | 워크플로우 블록 |
| **목적** | 대화 흐름 설계 | 전체 시나리오 구성 |
| **진입** | 라이브러리 → 워크플로우 클릭 | 빌더 탭 → 새 시나리오 |
| **입도** | 세밀한 노드 수준 | 워크플로우 수준 |

---

## 사용 시나리오

### Case 1: 새 워크플로우 만들기

1. **워크플로우 라이브러리** 탭
2. **[+ 새 워크플로우]** 버튼
3. 마법사로 기본 정보 입력
4. 라이브러리에 생성됨
5. **워크플로우 카드 클릭** → 워크플로우 빌더 열림
6. 노드 추가 및 연결
7. **[저장]**

### Case 2: 기존 워크플로우 수정

1. **워크플로우 라이브러리** 탭
2. 수정할 워크플로우 카드 클릭
3. 워크플로우 빌더에서 노드 편집
4. **[저장]**

### Case 3: 시나리오 만들기

1. **시나리오 구성** 탭
2. **[🎯 새 시나리오]** 버튼
3. **플로우 에디터 모드** 선택
4. **[+ 워크플로우 추가]**로 필요한 워크플로우 배치
5. 워크플로우 간 연결선 그리기
6. **[저장]**

---

## 데이터 흐름

```
워크플로우 생성 마법사
    ↓
워크플로우 라이브러리에 저장
    ↓
워크플로우 빌더로 노드 설계
    ↓
완성된 워크플로우
    ↓
시나리오 플로우 에디터에서 조합
    ↓
완성된 시나리오
```

---

## 주요 차이점

### 워크플로우 빌더
- **미시적 관점**: 한 대화 흐름의 세부 구현
- **노드 단위**: 개별 AI 응답, 조건 분기 등
- **예시**: "반품 문의를 받아 → AI가 답변 → 상태 전환"

### 시나리오 플로우 에디터
- **거시적 관점**: 전체 고객 여정 설계
- **워크플로우 단위**: 완성된 대화 흐름 블록
- **예시**: "초기인사 → 고객확인 → 용건파악 → 만족도조사 → 종료"

---

## 실제 사용 흐름

### 개발자/설계자 워크플로우
```
1. 워크플로우 빌더에서 재사용 가능한 블록 만들기
   - "초기 인사"
   - "고객 정보 확인"
   - "주문 조회"
   - "반품 처리"
   등...

2. 시나리오 플로우 에디터에서 조합
   - "기본 CS 시나리오" = 초기인사 + 고객확인 + ...
   - "반품 시나리오" = 초기인사 + 주문조회 + 반품처리 + ...
   - "VIP 시나리오" = VIP인사 + 우선처리 + ...
```

---

## 구현 상태

### ✅ 완료
- 워크플로우 빌더 UI
- 시나리오 플로우 에디터 UI
- 노드 추가/삭제
- 연결선 그리기
- 라이브러리 연동

### 🚧 예정
- 노드 드래그앤드롭 이동
- 연결선 인터랙티브 생성
- 노드 설정 상세 편집
- 실시간 유효성 검증
- 시뮬레이션 실행

